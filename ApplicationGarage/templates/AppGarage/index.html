{% extends "AppGarage/layout.html" %}
{% load static %}

{% block body %}

<style>
    #main-container {
        background: rgb(255, 255, 255);
        background: linear-gradient(162deg, rgba(195, 195, 195, 0.8869922969187675) 0%, rgba(173, 173, 173, 0.7301295518207283) 35%, rgba(219, 249, 255, 1) 100%);
        display: grid;
        /* grid-template-columns: repeat(auto-fill, 200px); */
        grid-template-columns: repeat(auto-fill, 200px) minmax(min-content, 33vh);
        /* grid-template-columns: 33% 33% 33%; */

        justify-content: space-evenly;
        /*  */

    }

    .ad-container {
        background-color: rgb(255, 191, 114);
        height: 30vh;
        text-align: center;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
        transition: 0.3s;
        max-width: 100%;
        height: 30vh;
        position: relative;
        /*  */
        grid-column-start: col-start 1;
        grid-column: 1 / -1;
        grid-column-start: 0;
        /* width: 3000px !important; */
        height: fit-content;
        padding-top: 3vh;
        padding-bottom: 3vh;
    }

    /* .item-Container:nth-child(6) {
    } */

    .item-Container {
        /* background: sienna; */

        overflow: auto;
        margin: 2px;

        transition: 0.3s;
        /* max-width: 300px; */
        opacity: 0.75;
        position: relative;
        /* height: 25vh;
        width: 25vh; */
        border-radius: 9px;
        /* overflow: scroll; */
        max-height: 200px;
    }


    .item-Container:hover {
        opacity: 1;
        z-index: 0;
    }

    .item-image:hover {
        box-shadow: 0 8px 16px 0 rgba(0, 0, 0, 0.2);

    }

    .item-image {
        border: 0..8px solid rgb(223, 245, 191);
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
        /*  */
        max-width: 200px;
        max-height: 100%;
        max-width: 100%;

        z-index: 0;

        max-width: 100%;
        position: absolute;
        top: 0;
        top: 50%;
        -ms-transform: translateY(-50%);
        transform: translateY(-50%);
        width: 100%;
        height: 100%;
    }

    .item-footer {
        text-align: center;
        padding: 20px 16px;
        z-index: 2;
        background-color: rgba(66, 85, 137, 0.361);
        opacity: 0.1;
        position: inherit;
        position: relative;
        -ms-transform: translateY(-50%);
        transform: translateY(-50%);
        top: 50%;
        text-shadow: 0 0 5px black;
        color: white;
        /*  */
        max-height: 100%;
        max-width: 100%;

    }

    .item-footer:hover {
        background-color: rgba(39, 61, 124, 0.944);
        opacity: 1;
        z-index: 2;

    }

    .item-price {
        /* background-color: rgb(255, 123, 0); */
        background-color: rgb(255, 102, 0);
        text-shadow: 0 0 3px rgb(255, 255, 255);
        /* float: right; */
        right: 15px;
        bottom: 5px;
        position: absolute;
        padding: 5px;
        border-radius: 4px;
        z-index: 5;
    }

    .item-footer small {
        display: block;
    }
</style>


<!-- CREATING ELEMENTS WITH SCRIPTS -->
<script>

    function Create_ListContainer() {
        main_container = document.createElement('div');
        main_container.id = 'main-container';
        document.body.appendChild(main_container)
    }

    function OnloadItems() {
        toPopUp = 0
        var PoUp = setInterval(() => {
            current = allItemList.shift()
            Create_ListItem(current.fields);
            toPopUp++;
            if (toPopUp === 3) {
                clearInterval(PoUp);
            }
        }, 550)

    }
    function Create_ListItem(data) { //ITEM LIST
        datas = ['category', 'description', 'link', 'owner', 'price', 'time', 'title'];
        insideDIV = `
                <div class="item-footer">
                    <br>
                    The Description ${data.description}
                    <small>Seller: ${data.owner}</small>
                    <small>Contact: ${data.contact}</small>
                    <small>Time: ${data.time}</small>
                    <small>Category: ${data.category}</small>
                </div>
            <img class="item-image" src="${data.link}">
            <span class="item-price">Presyo: ${data.price}</span>
            <br>
            `
        itemContainer = document.createElement('div');
        itemContainer.setAttribute("class", "item-Container");
        itemContainer.innerHTML = insideDIV;
        main_container.appendChild(itemContainer);
    }
    function Remove_ListItem() {
        toRemove = document.querySelector(".item-Container");
        console.log('To Remove: ', toRemove)
        toRemove.remove()
    }
    function Create_Advertisments() {
        adContainer = document.createElement('div');
        adContainer.setAttribute("class", "ad-container");
        adContainer.innerHTML = `<div> <h1> The ADs are Created Here</h1> </div>`
        main_container.appendChild(adContainer)
    }
    async function SendRequest(url) {
        var i = 0
        allItemList = []

        let Allresponse = await fetch(url).then(response => response.json()).then(data => {
            dataCount = data.length
            var interVal = setInterval(() => {
                allItemList.push(data[i])
                i++;
                if (i >= dataCount) { // The number to pop
                    clearInterval(interVal);
                }
            }, 100);
            return data
        })
    }

</script>

<script>
    Create_ListContainer()
    SendRequest('KuhainAngListing') // fetch url
    OnloadItems()


    function Create_RandomListItem(min, max) {
        ItemCount = allItemList.length
        if (ItemCount > 0) {
            toIndex = Math.floor(Math.random() * (max - min) + min);
            if (allItemList[toIndex]) {
                indexPosition = allItemList.indexOf(allItemList[toIndex])
                Position = allItemList.splice(toIndex, 1)
                // console.log('yes: ', Position)
                console.log('YES')
                // console.log('Fields: ', Position[0].fields)
                Create_ListItem(Position[0].fields)
                return Position
            }
            console.log('No still got:  ', ItemCount)
            Create_RandomListItem(0, (ItemCount - 1))
        } else {
            console.log('Empty')
        }
    }
    // INITIATE THIS TO ADD 
    Create_RandomListItem(0, allItemList.length)


</script>
{%endblock%}